<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Chapter 18. Floating-point environment &lt;fenv.h></title><link href="../../css/style.css" rel="stylesheet" type="text/css"><meta content="DocBook XSL-NS Stylesheets V1.76.1" name="generator"><link href="../index.html" rel="home" title="C Programming with C99"><link href="../index.html" rel="up" title="C Programming with C99"><link href="../errno/index.html" rel="prev" title="Chapter 17. Errors &lt;errno.h>"><link href="../float/index.html" rel="next" title="Chapter 19. Characterictics of floating types &lt;float.h>"><script src="../css/analytics.js" type="text/javascript" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format"></script></link></link></link></link></meta></link></meta></head><body alink="#0000FF" bgcolor="white" link="#0000FF" text="black" vlink="#840084"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter 18. Floating-point environment &lt;fenv.h></th></tr><tr><td align="left" width="20%"><a accesskey="p" href="../errno/index.html">Prev</a> </td><th align="center" width="60%"> </th><td align="right" width="20%"> <a accesskey="n" href="../float/index.html">Next</a></td></tr></table><hr/></div><div class="chapter" title="Chapter 18. Floating-point environment &lt;fenv.h>"><div class="titlepage"><div><div><h2 class="title"><a name="idp625008"></a>Chapter 18. Floating-point environment &lt;fenv.h></h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="index.html#idp2218976">18.1. The FENV_ACCESS pragma</a></span></dt><dt><span class="sect1"><a href="index.html#idp2006576">18.2. Floating-point exceptions</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp2394272">18.2.1. The feclearexcept function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4453312">18.2.2. The fegetexceptflag function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4459184">18.2.3. The feraiseexcept function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4466096">18.2.4. The fesetexceptflag function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4473440">18.2.5. The fetestexcept function</a></span></dt></dl></dd><dt><span class="sect1"><a href="index.html#idp4481904">18.3. Rounding</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp4483888">18.3.1. The fegetround function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4489680">18.3.2. The fesetround function</a></span></dt></dl></dd><dt><span class="sect1"><a href="index.html#idp4497088">18.4. Environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp4498304">18.4.1. The fegetenv function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4504048">18.4.2. The feholdexcept function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4528176">18.4.3. The fesetenv function</a></span></dt><dt><span class="sect2"><a href="index.html#idp4535440">18.4.4. The feupdateenv function</a></span></dt></dl></dd></dl></div><p>The header &lt;fenv.h> declares two types and several macros
    and functions to provide access to the floating-point environment. The
    floating-point environment refers collectively to any floating-point status
    flags and control modes supported by the
    implementation.<sup>[<a class="footnote" href="#ftn.idp618416" name="idp618416">152</a>]</sup> A floating-point status flag is a system
    variable whose value is set (but never cleared) when a floating-point
    exception is raised, which occurs as a side effect of exceptional
    floating-point arithmetic to provide auxiliary information. A
    floating-point control mode is a system variable whose value may be set by
    the user to affect the subsequent behavior of floating-point
    arithmetic.</p><p>Certain programming conventions support the intended model of use
    for the floating-point environment:<sup>[<a class="footnote" href="#ftn.idp2051744" name="idp2051744">153</a>]</sup></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>a function call does not alter its caller's floating-point
	control modes, clear its caller’s floating-point status flags, nor
	depend on the state of its caller’s floating-point status flags unless
	the function is so documented;</p></li><li class="listitem"><p>a function call is assumed to require default floating-point
	control modes, unless its documentation promises otherwise;</p></li><li class="listitem"><p>a function call is assumed to have the potential for raising
	floating-point exceptions, unless its documentation promises
	otherwise.</p></li></ul></div><p>The type <code class="code">fenv_t</code> represents the entire
    floating-point environment.</p><p>The type <code class="code">fexcept_t</code> represents the floating-point
    status flags collectively, including any status the implementation
    associates with the flags.</p><p>Each of the macros:</p><div class="blockquote"><blockquote class="blockquote"><p>FE_DIVBYZERO FE_INEXACT FE_INVALID FE_OVERFLOW FE_UNDERFLOW</p></blockquote></div><p>is defined if and only if the implementation supports the
floating-point exception by means of the functions in
13.6.2.<sup>[<a class="footnote" href="#ftn.idp2025184" name="idp2025184">154</a>]</sup> Additional
implementation-defined floating-point exceptions, with macro definitions
beginning with <code class="code">FE_</code> and an uppercase letter, may also be
specified by the implementation. The defined macros expand to integer constant
expressions with values such that bitwise <code class="code">OR</code>s of all
combinations of the macros result in distinct values.</p><p>The macro <code class="code">FE_ALL_EXCEPT</code> is simply the bitwise
<code class="code">OR</code> of all floating-point exception macros defined by the
implementation. If no such macros are defined, <code class="code">FE_ALL_EXCEPT</code>
shall be defined as 0.</p><p>Each of the macros:</p><pre class="screen">FE_DOWNWARD
FE_TONEAREST
FE_TOWARDZERO
FE_UPWARD</pre><p>is defined if and only if the implementation supports getting and
setting the represented rounding direction by means of the fegetround and
fesetround functions. Additional implementation-defined rounding directions,
with macro definitions beginning with FE_ and an uppercase letter, may also be
specified by the implementation. The defined macros expand to integer constant
expressions whose values are distinct nonnegative
values.<sup>[<a class="footnote" href="#ftn.idp2030624" name="idp2030624">155</a>]</sup></p><p>The macro <code class="code">FE_DFL_ENV</code> represents the default
floating-point environment - the one installed at program startup - and has
type "pointer to const-qualified <code class="code">fenv_t</code>”. It can be used as an
argument to &lt;fenv.h> functions that manage the floating-point
environment.</p><p>Additional implementation-defined environments, with macro definitions
beginning with <code class="code">FE_</code> and an uppercase letter, and having type
"pointer to const-qualified <code class="code">fenv_t</code>", may also be specified by
the implementation.</p><div class="sect1" title="18.1. The FENV_ACCESS pragma"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp2218976"></a>18.1. The FENV_ACCESS pragma</h2></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="cp">#pragma STDC FENV_ACCESS on-off-switch</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">FENV_ACCESS</code> pragma provides a means to inform the
implementation when a program might access the floating-point environment to
test floating-point status flags or run under non-default floating-point
control modes.<sup>[<a class="footnote" href="#ftn.idp2222832" name="idp2222832">156</a>]</sup> The
pragma shall occur either outside external declarations or preceding all
explicit declarations and statements inside a compound statement. When outside
external declarations, the pragma takes effect from its occurrence until
another <code class="code">FENV_ACCESS</code>pragma is encountered, or until the end of
the translation unit. When inside a compound statement, the pragma takes effect
from its occurrence until another <code class="code">FENV_ACCESS</code> pragma is
encountered (including within a nested compound statement), or until the end of
the compound statement; at the end of a compound statement the state for the
pragma is restored to its condition just before the compound statement. If this
pragma is used in any other context, the behavior is undefined. If part of a
program tests floating-point status flags, sets floating-point control modes,
or runs under non-default mode settings, but was translated with the state for
the <code class="code">FENV_ACCESS</code> pragma "off", the behavior is undefined. The
default state ("on" or "off") for the pragma is implementation-defined. (When
execution passes from a part of the program translated with
<code class="code">FENV_ACCESS</code> "off" to a part translated with
<code class="code">FENV_ACCESS</code> "on", the state of the floating-point status flags
is unspecified and the floating-point control modes have their default
settings.)</p><p>EXAMPLE</p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cp">#pragma STDC FENV_ACCESS ON</span>
  <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">h</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
  <span class="cm">/* ... */</span>
  <span class="n">g</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">h</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</pre><p>If the function <code class="code">g</code> might depend on status flags set as
a side effect of the first <code class="code">x + 1</code>, or if the second <code class="code">x +
1</code> might depend on control modes set as a side effect of the call to
function <code class="code">g</code>, then the program shall contain an appropriately
placed invocation of <code class="code">#pragma STDC FENV_ACCESS
ON</code>.<sup>[<a class="footnote" href="#ftn.idp2004480" name="idp2004480">157</a>]</sup></p></div><div class="sect1" title="18.2. Floating-point exceptions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp2006576"></a>18.2. Floating-point exceptions</h2></div></div></div><p>The following functions provide access to the floating-point status
  flags.<sup>[<a class="footnote" href="#ftn.idp2404704" name="idp2404704">158</a>]</sup> The <code class="code">int</code> input argument for the
  functions represents a subset of floating-point exceptions, and can be zero
  or the bitwise OR of one or more floating-point exception macros, for example
  <code class="code">FE_OVERFLOW | FE_INEXACT</code>. For other argument values the
  behavior of these functions is undefined.</p><div class="sect2" title="18.2.1. The feclearexcept function"><div class="titlepage"><div><div><h3 class="title"><a name="idp2394272"></a>18.2.1. The feclearexcept function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">feclearexcept</span><span class="p">(</span><span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">feclearexcept</code> function attempts to clear the
supported floating-point exceptions represented by its argument.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">feclearexcept</code> function returns zero if the excepts
argument is zero or if all the specified exceptions were successfully
cleared. Otherwise, it returns a nonzero value.</p><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">feclearexcept</span><span class="p">(</span><span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p>Link with <code class="code">-lm.</code></p><p>Following description, exceptions, rounding mode, floating-point
environment and return values are applicable to all functions of this
header</p><p><span class="bold"><strong>Description</strong></span></p><p>This function was defined in C99, and describe the handling of
floating-point rounding and exceptions (overflow, zero-divide, etc.).</p><p><span class="bold"><strong>Exceptions</strong></span></p><p>The <span class="italic">divide-by-zero</span> exception
occurs when an operation on finite numbers produces infinity as exact
answer.</p><p>The <span class="italic">overflow</span> exception occurs
when a result has to be represented as a floating-point number, but has (much)
larger absolute value than the largest (finite) floating-point number that is
representable.</p><p>The <span class="italic">underflow</span> exception occurs
when a result has to be represented as a floating-point number, but has smaller
absolute value than the smallest positive normalized floating-point number (and
would lose much accuracy when represented as a denormalized number).</p><p>The <span class="italic">inexact</span> exception occurs
when the rounded result of an operation is not equal to the infinite precision
result. It may occur whenever <span class="italic">overflow</span>
or <span class="italic">underflow</span> occurs.</p><p>The <span class="italic">invalid</span> exception occurs
when there is no well-defined result for an operation, as for 0/0 or infinity -
infinity or sqrt(-1).</p><p><span class="bold"><strong>Exception Handling</strong></span></p><p>Exceptions are represented in two ways: as a single bit (exception
present/absent), and these bits correspond in some implementation- defined way
with bit positions in an integer, and also as an opaque structure that may
contain more information about the exception (perhaps the code address where it
occurred).</p><p>Each of the macros <code class="code">FE_DIVBYZERO, FE_INEXACT,  FE_INVALID,
FE_OVERFLOW, FE_UNDERFLOW</code> is defined when the implementation supports
handling of the corresponding exception, and if so then defines the
corresponding bit(s), so that one can call exception handling functions, for
example, using the integer argument
<code class="code">FE_OVERFLOW|FE_UNDERFLOW</code>. Other exceptions may be
supported. The macro <code class="code">FE_ALL_EXCEPT</code> is the bitwise OR of all
bits corresponding to supported exceptions.</p><p>The <code class="code">feclearexcept()</code> function clears the supported
exceptions represented by the bits in its argument.</p><p>The <code class="code">fegetexceptflag()</code> function stores a representation
of the state of the exception flags represented by the argument excepts in the
opaque object <code class="code">*flagp</code>.</p><p>The <code class="code">feraiseexcept()</code> function raises the supported
exceptions represented by the bits in excepts.</p><p>The <code class="code">fesetexceptflag()</code> function sets the complete
status for the exceptions represented by excepts to the value
<code class="code">*flagp</code>. This value must have been obtained by an earlier call
of <code class="code">fegetexceptflag()</code> with a last argument that contained all
bits in excepts.</p><p>The <code class="code">fetestexcept()</code> function returns a word in which
the bits are set that were set in the argument excepts and for which the
corresponding exception is currently set.</p><p><span class="bold"><strong>Rounding Mode</strong></span></p><p>The rounding mode determines how the result of floating-point
operations is treated when the result cannot be exactly represented in the
significand. Various rounding modes may be provided: round to nearest (the
default), round up (toward positive infinity), round down (toward negative
infinity), and round toward zero.</p><p>Each of the macros <code class="code">FE_TONEAREST, FE_UPWARD,
FE_DOWNWARD</code> and <code class="code">FE_TOWARDZERO</code> is defined when the
implementation supports getting and setting the corresponding rounding
direction.</p><p>The <code class="code">fegetround()</code> function returns the macro
corresponding to the current rounding mode.</p><p>The <code class="code">fesetround()</code> function sets the rounding mode as
specified by its argument and returns zero when it was successful.</p><p>C99 and POSIX.1-2008 specify an identifier,
<code class="code">FLT_ROUNDS</code>, defined in &lt;float.h>, which indicates the
implementation-defined rounding behavior for floating-point addition. This
identifier has one of the following values:</p><div class="blockquote"><blockquote class="blockquote"><p>-1 The rounding mode is not determinable.</p><p>1 Rounding is toward nearest number.</p><p>2 Rounding is toward positive infinity.</p><p>3 Rounding is toward negative infinity.</p></blockquote></div><p>Other values represent machine-dependent, nonstandard rounding
modes.</p><p>The value of <code class="code">FLT_ROUNDS</code> should reflect the current
rounding mode as set by <code class="code">fesetround()</code>.</p><p><span class="bold"><strong>Floating-point
environment</strong></span></p><p>The entire floating-point environment, including control modes and
status flags, can be handled as one opaque object, of type
<code class="code">fenv_t</code>. The default environment is denoted by
<code class="code">FE_DFL_ENV</code> (of type <code class="code">const fenv_t *</code>). This is
the environment setup at program start and it is defined by ISO C to have round
to nearest, all exceptions cleared and a nonstop (continue on exceptions)
mode.</p><p>The <code class="code">fegetenv()</code> function saves the current
floating-point environment in the object <code class="code">*envp</code>.</p><p>The <code class="code">feholdexcept()</code> function does the same, then clears
all exception flags, and sets a nonstop (continue on exceptions) mode, if
available. It returns zero when successful.</p><p>The <code class="code">fesetenv()</code> function restores the floating-point
environment from the object <code class="code">*envp</code>. This object must be known
to be valid, for example, the result of a call to <code class="code">fegetenv()</code>
or <code class="code">feholdexcept()</code> or equal to
<code class="code">FE_DFL_ENV</code>. This call does not raise exceptions.</p><p>The <code class="code">feupdateenv()</code> function installs the floating-point
environment represented by the object <code class="code">*envp</code>, except that
currently raised exceptions are not cleared. After calling this function, the
raised exceptions will be a bitwise OR of those previously set with those in
<code class="code">*envp</code>. As before, the object <code class="code">*envp</code> must be
known to be valid.</p><p><span class="bold"><strong>RETURN VALUE</strong></span></p><p>These functions return zero on success and nonzero if an error
occurred.</p></div><div class="sect2" title="18.2.2. The fegetexceptflag function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4453312"></a>18.2.2. The fegetexceptflag function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fegetexceptflag</span><span class="p">(</span><span class="n">fexcept_t</span> <span class="o">*</span><span class="n">flagp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fegetexceptflag</code> function attempts to store an
implementation-defined representation of the states of the floating-point
status flags indicated by the argument excepts in the object pointed to by the
argument flagp.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fegetexceptflag</code> function returns zero if the
representation was successfully stored. Otherwise, it returns a nonzero
value.</p></div><div class="sect2" title="18.2.3. The feraiseexcept function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4459184"></a>18.2.3. The feraiseexcept function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">feraiseexcept</span><span class="p">(</span><span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">feraiseexcept</code> function attempts to raise the
supported floating-point exceptions represented by its
argument.<sup>[<a class="footnote" href="#ftn.idp4462944" name="idp4462944">159</a>]</sup> The order in which these floating-point
exceptions are raised is unspecified, except as stated in F.7.6 of
specification. Whether the feraiseexcept function additionally raises the
"inexact" floating-point exception whenever it raises the "overflow" or
"underflow" floating-point exception is implementation-defined.</p><p><span class="bold"><strong>Return</strong></span></p><p>The <code class="code">feraiseexcept</code> function returns zero if the excepts
argument is zero or if all the specified exceptions were successfully
raised. Otherwise, it returns a nonzero value.</p></div><div class="sect2" title="18.2.4. The fesetexceptflag function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4466096"></a>18.2.4. The fesetexceptflag function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fesetexceptflag</span><span class="p">(</span><span class="k">const</span> <span class="n">fexcept_t</span> <span class="o">*</span><span class="n">flagp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fesetexceptflag</code> function attempts to set the
floating-point status flags indicated by the argument excepts to the states
stored in the object pointed to by <code class="code">flagp</code>. The value of
<code class="code">*flagp</code> shall have been set by a previous call to
<code class="code">fegetexceptflag</code> whose second argument represented at least
those floating-point exceptions represented by the argument excepts. This
function does not raise floating-point exceptions, but only sets the state of
the flags.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fesetexceptflag</code> function returns zero if the
excepts argument is zero or if all the specified flags were successfully set to
the appropriate state. Otherwise, it returns a nonzero value.</p></div><div class="sect2" title="18.2.5. The fetestexcept function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4473440"></a>18.2.5. The fetestexcept function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fetestexcept</span><span class="p">(</span><span class="kt">int</span> <span class="n">excepts</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The fetestexcept function determines which of a specified subset of the
floating-point exception flags are currently set. The excepts argument
specifies the floating-point status flags to be
queried.<sup>[<a class="footnote" href="#ftn.idp4476880" name="idp4476880">160</a>]</sup></p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fetestexcept</code> function returns the value of the
bitwise OR of the floating-point exception macros corresponding to the
currently set floating-point exceptions included in
<code class="code">excepts</code>.</p></div></div><div class="sect1" title="18.3. Rounding"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp4481904"></a>18.3. Rounding</h2></div></div></div><p>The <code class="code">fegetround</code> and <code class="code">fesetround</code>
  functions provide control of rounding direction modes.</p><div class="sect2" title="18.3.1. The fegetround function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4483888"></a>18.3.1. The fegetround function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fegetround</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fegetround</code> function gets the current rounding
direction.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fegetround</code> function returns the value of the
rounding direction macro representing the current rounding direction or a
negative value if there is no such rounding direction macro or the current
rounding direction is not determinable.</p></div><div class="sect2" title="18.3.2. The fesetround function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4489680"></a>18.3.2. The fesetround function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fesetround</span><span class="p">(</span><span class="kt">int</span> <span class="n">round</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fesetround</code> function establishes the rounding
direction represented by its argument round. If the argument is not equal to
the value of a rounding direction macro, the rounding direction is not
changed.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fesetround</code> function returns zero if and only if
the requested rounding direction was established.</p><p>EXAMPLE Save, set, and restore the rounding direction. Report an error
and abort if setting the rounding direction fails.</p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="cp">#include &lt;assert.h&gt;</span>
<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">round_dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cp">#pragma STDC FENV_ACCESS ON</span>
  <span class="kt">int</span> <span class="n">save_round</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">setround_ok</span><span class="p">;</span>
  <span class="n">save_round</span> <span class="o">=</span> <span class="n">fegetround</span><span class="p">();</span>
  <span class="n">setround_ok</span> <span class="o">=</span> <span class="n">fesetround</span><span class="p">(</span><span class="n">round_dir</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">setround_ok</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
  <span class="cm">/* ... */</span>
  <span class="n">fesetround</span><span class="p">(</span><span class="n">save_round</span><span class="p">);</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</pre></div></div><div class="sect1" title="18.4. Environment"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp4497088"></a>18.4. Environment</h2></div></div></div><p>The functions in this section manage the floating-point environment
    - status flags and control modes - as one entity.</p><div class="sect2" title="18.4.1. The fegetenv function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4498304"></a>18.4.1. The fegetenv function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fegetenv</span><span class="p">(</span><span class="n">fenv_t</span> <span class="o">*</span><span class="n">envp</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fegetenv</code> function attempts to store the current
floating-point environment in the object pointed to by envp.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fegetenv</code> function returns zero if the environment
was successfully stored. Otherwise, it returns a nonzero value.</p></div><div class="sect2" title="18.4.2. The feholdexcept function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4504048"></a>18.4.2. The feholdexcept function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">feholdexcept</span><span class="p">(</span><span class="n">fenv_t</span> <span class="o">*</span><span class="n">envp</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">feholdexcept</code> function saves the current
floating-point environment in the object pointed to by <code class="code">envp</code>,
clears the floating-point status flags, and then installs a non-stop (continue
on floating-point exceptions) mode, if available, for all floating-point
exceptions.<sup>[<a class="footnote" href="#ftn.idp4508368" name="idp4508368">161</a>]</sup></p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">feholdexcept</code> function returns zero if and only if
non-stop floating-point exception handling was successfully installed.</p></div><div class="sect2" title="18.4.3. The fesetenv function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4528176"></a>18.4.3. The fesetenv function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">fesetenv</span><span class="p">(</span><span class="k">const</span> <span class="n">fenv_t</span> <span class="o">*</span><span class="n">envp</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">fesetenv</code> function attempts to establish the
floating-point environment represented by the object pointed to by
<code class="code">envp</code>. The argument envp shall point to an object set by a call
to <code class="code">fegetenv</code> or <code class="code">feholdexcept</code>, or equal a
floating-point environment macro. Note that fesetenv merely installs the state
of the floating-point status flags represented through its argument, and does
not raise these floating-point exceptions.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">fesetenv</code> function returns zero if the environment
was successfully established. Otherwise, it returns a nonzero value.</p></div><div class="sect2" title="18.4.4. The feupdateenv function"><div class="titlepage"><div><div><h3 class="title"><a name="idp4535440"></a>18.4.4. The feupdateenv function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">int</span> <span class="n">feupdateenv</span><span class="p">(</span><span class="k">const</span> <span class="n">fenv_t</span> <span class="o">*</span><span class="n">envp</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">feupdateenv</code> function attempts to save the
currently raised floating-point exceptions in its automatic storage, install
the floating-point environment represented by the object pointed to by
<code class="code">envp</code>, and then raise the saved floating-point exceptions. The
argument <code class="code">envp</code> shall point to an object set by a call to
<code class="code">feholdexcept</code> or <code class="code">fegetenv</code>, or equal a
floating-point environment macro.</p><p><span class="bold"><strong>Returns</strong></span></p><p>The <code class="code">feupdateenv</code> function returns zero if all the
actions were successfully carried out. Otherwise, it returns a nonzero
value.</p><p>EXAMPLE Hide spurious underflow floating-point exceptions:</p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="kt">double</span> <span class="nf">f</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cp">#pragma STDC FENV_ACCESS ON</span>
  <span class="kt">double</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">fenv_t</span> <span class="n">save_env</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">feholdexcept</span><span class="p">(</span><span class="o">&amp;</span><span class="n">save_env</span><span class="p">))</span>
    <span class="k">return</span> <span class="cm">/* indication of an environmental problem */</span><span class="p">;</span>
  <span class="c1">// compute result</span>
  <span class="k">if</span> <span class="p">(</span><span class="cm">/* test spurious underflow */</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">feclearexcept</span><span class="p">(</span><span class="n">FE_UNDERFLOW</span><span class="p">))</span>
      <span class="k">return</span> <span class="cm">/* indication of an environmental problem */</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">feupdateenv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">save_env</span><span class="p">))</span>
    <span class="k">return</span> <span class="cm">/* indication of an environmental problem */</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</pre></div></div><div class="footnotes"><br><hr align="left" width="100"><div class="footnote"><p><sup>[<a class="para" href="#idp618416" id="ftn.idp618416">152</a>] </sup>This header is designed to support the
    floating-point exception status flags and directed-rounding control modes
    required by IEC 60559, and other similar floating-point state
    information. Also it is designed to facilitate code portability among all
    systems.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2051744" id="ftn.idp2051744">153</a>] </sup>With these
    conventions, a programmer can safely assume default floating-point control
    modes (or be unaware of them). The responsibilities associated with
    accessing the floating-point environment fall on the programmer or program
    that does so explicitly.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2025184" id="ftn.idp2025184">154</a>] </sup>The implementation supports an exception if there
are circumstances where a call to at least one of the functions in 13.6.2,
using the macro as the appropriate argument, will succeed. It is not necessary
for all the functions to succeed all the time.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2030624" id="ftn.idp2030624">155</a>] </sup>Even though the rounding direction macros may expand
to constants corresponding to the values of <code class="code">FLT_ROUNDS</code>, they
are not required to do so.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2222832" id="ftn.idp2222832">156</a>] </sup>The purpose of the
<code class="code">FENV_ACCESS</code> pragma is to allow certain optimizations that
could subvert flag tests and mode changes (e.g., global common subexpression
elimination, code motion, and constant folding). In general, if the state of
<code class="code">FENV_ACCESS</code> is "off", the translator can assume that default
modes are in effect and the flags are not tested.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2004480" id="ftn.idp2004480">157</a>] </sup>The side effects impose a temporal ordering
that requires two evaluations of <code class="code">x + 1</code>. On the other hand,
without the <code class="code">#pragma STDC FENV_ACCESS ON</code> pragma, and assuming
the default state is "off", just one evaluation of <code class="code">x + 1</code> would
suffice.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp2404704" id="ftn.idp2404704">158</a>] </sup>The functions <code class="code">fetestexcept,
  feraiseexcept</code> and <code class="code">feclearexcept</code> support the basic
  abstraction of flags that are either set or clear. An implementation may
  endow floating-point status flags with more information - for example, the
  address of the code which first raised the floating-point exception; the
  functions <code class="code">fegetexceptflag</code> and
  <code class="code">fesetexceptflag</code> deal with the full content of
  flags.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp4462944" id="ftn.idp4462944">159</a>] </sup>The effect is intended to be similar to that of
floating-point exceptions raised by arithmetic operations. Hence, enabled traps
for floating-point exceptions raised by this function are taken. The
specification in F.7.6 of specification is in the same
spirit.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp4476880" id="ftn.idp4476880">160</a>] </sup>This mechanism allows testing several
floating-point exceptions with just one function call.</p><p>EXAMPLE
Call <code class="code">f</code> if "invalid" is set, then <code class="code">g</code> if
"overflow" is set:</p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;fenv.h&gt;</span>
<span class="cm">/* ... */</span>
<span class="p">{</span>
  <span class="cp">#pragma STDC FENV_ACCESS ON</span>
  <span class="kt">int</span> <span class="n">set_excepts</span><span class="p">;</span>
  <span class="n">feclearexcept</span><span class="p">(</span><span class="n">FE_INVALID</span> <span class="o">|</span> <span class="n">FE_OVERFLOW</span><span class="p">);</span>
  <span class="c1">// maybe raise exceptions</span>
  <span class="n">set_excepts</span> <span class="o">=</span> <span class="n">fetestexcept</span><span class="p">(</span><span class="n">FE_INVALID</span> <span class="o">|</span> <span class="n">FE_OVERFLOW</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">set_excepts</span> <span class="o">&amp;</span> <span class="n">FE_INVALID</span><span class="p">)</span> <span class="n">f</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">set_excepts</span> <span class="o">&amp;</span> <span class="n">FE_OVERFLOW</span><span class="p">)</span> <span class="n">g</span><span class="p">();</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</pre></div><div class="footnote"><p><sup>[<a class="para" href="#idp4508368" id="ftn.idp4508368">161</a>] </sup>IEC 60559 systems have a default non-stop mode,
and typically at least one other mode for trap handling or aborting; if the
system provides only the non-stop mode then installing it is trivial. For such
systems, the <code class="code">feholdexcept</code> function can be used in conjunction
with the <code class="code">feupdateenv</code> function to write routines that hide
spurious floating-point exceptions from their
callers.</p></div></hr></br></div></div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="../errno/index.html">Prev</a> </td><td align="center" width="20%"> </td><td align="right" width="40%"> <a accesskey="n" href="../float/index.html">Next</a></td></tr><tr><td align="left" valign="top" width="40%">Chapter 17. Errors &lt;errno.h> </td><td align="center" width="20%"><a accesskey="h" href="../index.html">Home</a></td><td align="right" valign="top" width="40%"> Chapter 19. Characterictics of floating types &lt;float.h></td></tr></table></hr></div><p style="text-align: center;" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format">© 2010, 2013 Shiv S. Dayal. <a href="http://libreprogramming.org">libreprogramming.org</a>.
    GNU FDL license is applicable where not stated.</p></body></html>
