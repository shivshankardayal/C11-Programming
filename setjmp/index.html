<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>Chapter 25. Nonlocal jumps &lt;setjmp.h></title><link href="../css/bootstrap.css" rel="stylesheet" type="text/css"/><link href="../css/style.css" rel="stylesheet" type="text/css"/><meta content="DocBook XSL-NS Stylesheets V1.76.1" name="generator"/><link href="../index.html" rel="home" title="C Programming with C99"/><link href="../index.html" rel="up" title="C Programming with C99"/><link href="../math/index.html" rel="prev" title="Chapter 24. Mathematics &lt;math.h>"/><link href="../signal/index.html" rel="next" title="Chapter 26. Signal handling &lt;signal.h>"/><script src="/css/jquery.js" type="text/javascript" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format"></script><script src="/css/bootstrap.js" type="text/javascript" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format"></script><script src="/css/analytics.js" type="text/javascript" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format"></script></head><body alink="#0000FF" bgcolor="white" link="#0000FF" text="black" vlink="#840084"><div id="navbar" class="navbar navbar-fixed-top">    <div class="navbar-inner">      <div class="container-fluid">      <a class="brand" href="http://libreprogramming.org/">Home</a>      <a class="brand" href="http://libreprogramming.org/books/">Books</a>  <ul class="nav">  <li class="dropdown">      <a href="#"            class="dropdown-toggle"            data-toggle="dropdown">Chapter 25. Nonlocal jumps &lt;setjmp.h><b class="caret"></b>      </a>      <ul class="dropdown-menu"><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="index.html#idp2114192">25.1. Save calling environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp2114944">25.1.1. The setjmp macro</a></span></dt></dl></dd><dt><span class="sect1"><a href="index.html#idp5269648">25.2. Restore calling environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp5270400">25.2.1. The longjmp function</a></span></dt></dl></dd></dl></div>     </ul>    </li>  </ul> <ul class="nav"><li><a href="../math/index.html">&lt;&lt; Chapter 24. Mathematics &lt;math.h> </a><li><li><a href="../signal/index.html"> Chapter 26. Signal handling &lt;signal.h> >></a><li></ul>    </div>    </div>  </div><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter 25. Nonlocal jumps &lt;setjmp.h></th></tr><tr><td align="left" width="20%"><a accesskey="p" href="../math/index.html">Prev</a> </td><th align="center" width="60%"> </th><td align="right" width="20%"> <a accesskey="n" href="../signal/index.html">Next</a></td></tr></table><hr/></div><div class="chapter" title="Chapter 25. Nonlocal jumps &lt;setjmp.h>"><div class="titlepage"><div><div><h2 class="title"><a name="idp904544"></a>Chapter 25. Nonlocal jumps &lt;setjmp.h></h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="index.html#idp2114192">25.1. Save calling environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp2114944">25.1.1. The setjmp macro</a></span></dt></dl></dd><dt><span class="sect1"><a href="index.html#idp5269648">25.2. Restore calling environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="index.html#idp5270400">25.2.1. The longjmp function</a></span></dt></dl></dd></dl></div><p>The header <code class="code">&lt;setjmp.h></code> defines the macro
  <code class="code">setjmp</code>, and declares one function and one type, for
  bypassing the normal function call and return
  discipline.<sup>[<a class="footnote" href="#ftn.idp2691456" name="idp2691456">185</a>]</sup></p><p>The type declared is</p><div class="blockquote"><blockquote class="blockquote"><p>jmp_buf</p></blockquote></div><p>which is an array type suitable for holding the information needed
  to restore a calling environment. The environment of a call to the setjmp
  macro consists of information sufficient for a call to the longjmp function
  to return execution to the correct block and invocation of that block, were
  it called recursively. It does not include the state of the floating-point
  status flags, of open files, or of any other component of the abstract
  machine.</p><p>It is unspecified whether <code class="code">setjmp</code> is a macro or an
  identifier declared with external linkage. If a macro definition is
  suppressed in order to access an actual function, or a program defines an
  external identifier with the name setjmp, the behavior is
  undefined.</p><div class="sect1" title="25.1. Save calling environment"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp2114192"></a>25.1. Save calling environment</h2></div></div></div><div class="sect2" title="25.1.1. The setjmp macro"><div class="titlepage"><div><div><h3 class="title"><a name="idp2114944"></a>25.1.1. The setjmp macro</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;setjmp.h&gt;</span>
<span class="kt">int</span> <span class="nf">setjmp</span><span class="p">(</span><span class="kt">jmp_buf</span> <span class="n">env</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">setjmp</code> macro saves its calling environment in its
<code class="code">jmp_buf</code> argument for later use by the <code class="code">longjmp</code>
function.</p><p><span class="bold"><strong>Returns</strong></span></p><p>If the return is from a direct invocation, the <code class="code">setjmp</code>
macro returns the value zero. If the return is from a call to the
<code class="code">longjmp</code> function, the <code class="code">setjmp</code> macro returns a
nonzero value.</p><p><span class="bold"><strong>Environmental limits</strong></span></p><p>An invocation of the <code class="code">setjmp</code> macro shall appear only in
one of the following contexts:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>the entire controlling expression of a selection or iteration
    statement;</p></li><li class="listitem"><p>one operand of a relational or equality operator with the other
    operand an integer constant expression, with the resulting expression being
    the entire controlling expression of a selection or iteration
    statement;</p></li><li class="listitem"><p>the operand of a unary ! operator with the resulting expression
    being the entire controlling expression of a selection or iteration
    statement; or</p></li><li class="listitem"><p>the entire expression of an expression statement (possibly cast to
    <code class="code">void</code>).</p></li></ul></div><p>If the invocation appears in any other context, the behavior is
undefined.</p></div></div><div class="sect1" title="25.2. Restore calling environment"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp5269648"></a>25.2. Restore calling environment</h2></div></div></div><div class="sect2" title="25.2.1. The longjmp function"><div class="titlepage"><div><div><h3 class="title"><a name="idp5270400"></a>25.2.1. The longjmp function</h3></div></div></div><p><span class="bold"><strong>Synopsis</strong></span></p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;setjmp.h&gt;</span>
<span class="kt">void</span> <span class="nf">longjmp</span><span class="p">(</span><span class="kt">jmp_buf</span> <span class="n">env</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">);</span>
</pre></div>
</pre><p><span class="bold"><strong>Description</strong></span></p><p>The <code class="code">longjmp</code> function restores the environment saved by
the most recent invocation of the <code class="code">setjmp</code> macro in the same
invocation of the program with the corresponding <code class="code">jmp_buf</code>
argument. If there has been no such invocation, or if the function containing
the invocation of the setjmp macro has terminated
execution<sup>[<a class="footnote" href="#ftn.idp5632944" name="idp5632944">186</a>]</sup> in the
interim, or if the invocation of the <code class="code">setjmp</code> macro was within
the scope of an identifier with variably modified type and execution has left
that scope in the interim, the behavior is undefined.</p><p>All accessible objects have values, and all other components of the
abstract machine<sup>[<a class="footnote" href="#ftn.idp5636080" name="idp5636080">187</a>]</sup>
have state, as of the time the <code class="code">longjmp</code> function was called,
except that the values of objects of automatic storage duration that are local
to the function containing the invocation of the corresponding setjmp macro
that do not have volatile-qualified type and have been changed between the
<code class="code">setjmp</code> invocation and <code class="code">longjmp</code> call are
indeterminate.</p><p><span class="bold"><strong>Returns</strong></span></p><p>After <code class="code">longjmp</code> is completed, program execution
continues as if the corresponding invocation of the <code class="code">setjmp</code>
macro had just returned the value specified by <code class="code">val</code>. The
<code class="code">longjmp</code> function cannot cause the <code class="code">setjmp</code>
macro to return the value 0; if val is 0, the <code class="code">setjmp</code> macro
returns the value 1.</p><p>EXAMPLE The <code class="code">longjmp</code> function that returns control back
to the point of the <code class="code">setjmp</code> invocation might cause memory
associated with a variable length array object to be squandered.</p><pre class="CLexer"><div class="highlight"><pre><span class="cp">#include &lt;1setjmp.h&gt;</span>

<span class="kt">jmp_buf</span> <span class="n">buf</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">g</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">h</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> <span class="c1">// valid: f is not terminated</span>
  <span class="n">setjmp</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
  <span class="n">g</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">g</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> <span class="c1">// a may remain allocated</span>
  <span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">h</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> <span class="c1">// b may remain allocated</span>
  <span class="n">longjmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// might cause memory loss</span>
<span class="p">}</span>
</pre></div>
</pre></div></div><div class="footnotes"><br/><hr align="left" width="100"/><div class="footnote"><p><sup>[<a class="para" href="#idp2691456" id="ftn.idp2691456">185</a>] </sup>These functions are useful for dealing with
  unusual conditions encountered in a low-level function of a
  program.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp5632944" id="ftn.idp5632944">186</a>] </sup>For example, by executing a
<code class="code">return</code> statement or because another <code class="code">longjmp</code>
call has caused a transfer to a <code class="code">setjmp</code> invocation in a
function earlier in the set of nested calls.</p></div><div class="footnote"><p><sup>[<a class="para" href="#idp5636080" id="ftn.idp5636080">187</a>] </sup>This includes, but is not limited to, the
floating-point status flags and the state of open files.</p></div></div></div><div class="navfooter"><hr/><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="../math/index.html">Prev</a> </td><td align="center" width="20%"> </td><td align="right" width="40%"> <a accesskey="n" href="../signal/index.html">Next</a></td></tr><tr><td align="left" valign="top" width="40%">Chapter 24. Mathematics &lt;math.h> </td><td align="center" width="20%"><a accesskey="h" href="../index.html">Home</a></td><td align="right" valign="top" width="40%"> Chapter 26. Signal handling &lt;signal.h></td></tr></table></div><p style="text-align: center;" xmlns:d="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:fo="http://www.w3.org/1999/XSL/Format">© 2010, 2013 Shiv S. Dayal. <a href="http://libreprogramming.org">libreprogramming.org</a>.
    GNU FDL license is applicable where not stated.</p></body></html>